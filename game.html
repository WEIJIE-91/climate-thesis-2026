<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°£å€™è®Šé·è¾²æ¥­æ‹–æ›³å¯¦é©— - å„ªåŒ–æµæš¢ç‰ˆ</title>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --bg-color: #ffffff;
            --root-bg: #FFF2CC;
            --root-border: #D6B656;
            --blue-bg: #DAE8FC;
            --blue-border: #6C8EBF;
            --purple-bg: #E1D5E7;
            --purple-border: #9673A6;
            --yellow-bg: #FFF2CC;
            --yellow-border: #D6B656;
            --header-bg: #D6B656; 
            --header-text: #000;
        }

        body {
            font-family: "Microsoft JhengHei", sans-serif;
            background-color: #f0f0f0;
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        #app-wrapper {
            background-color: white;
            padding: 20px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            max-width: 1500px; 
            width: 100%;
            display: flex;
            flex-direction: column;
        }

        /* å—è©¦è€…è³‡è¨Šæ¬„ */
        .student-info-row {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px 20px;
            background-color: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        
        .info-group { display: flex; align-items: center; gap: 10px; }
        .info-label { font-weight: bold; font-size: 16px; color: #333; }
        .info-input {
            padding: 8px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
            font-family: "Microsoft JhengHei", sans-serif;
            width: 150px;
        }

        /* é ‚éƒ¨æ¨™é¡Œåˆ— */
        .headers-row {
            display: flex;
            margin-bottom: 20px;
            position: relative;
            padding-left: 20px; 
            height: 40px;
        }

        .header-tag {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 8px 15px;
            border: 2px solid #000;
            border-radius: 8px;
            font-weight: bold;
            font-size: 16px;
            text-align: center;
            position: absolute; 
            white-space: nowrap;
            z-index: 5;
        }

        .content-area { display: flex; width: 100%; }

        /* å·¦å´åœ–è¡¨å€ */
        .diagram-container {
            flex: 3;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding-right: 20px;
            border-right: 2px dashed #ccc;
            position: relative;
        }

        /* å³å´å¾…é¸å€ */
        .sidebar {
            flex: 1;
            padding-left: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .sidebar-title {
            background-color: #D6B656;
            color: #000;
            width: 100%;
            text-align: center;
            padding: 10px 0;
            border-radius: 5px;
            font-weight: bold;
            margin-bottom: 20px;
            border: 2px solid #000;
        }

        .items-container {
            width: 100%;
            min-height: 500px;
            border: 2px dashed #ccc;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            align-items: center;
            background-color: #fafafa;
            border-radius: 10px;
        }

        /* æ‹–æ›³ç‰©ä»¶ */
        .draggable-item {
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #000;
            text-align: center;
            font-size: 13px;
            font-weight: bold;
            cursor: grab;
            width: 90%;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
            background: white;
            transition: transform 0.1s, box-shadow 0.1s;
            position: relative;
            z-index: 100; /* ç¢ºä¿æ‹–æ›³æ™‚åœ¨æœ€ä¸Šå±¤ */
        }
        
        .draggable-item:active { cursor: grabbing; transform: scale(0.98); }
        .item-purple { background-color: var(--purple-bg); border-color: var(--purple-border); }
        .item-yellow { background-color: var(--yellow-bg); border-color: var(--yellow-border); }

        /* åœ–è¡¨ç¯€é» */
        .node {
            padding: 5px 10px;
            border-radius: 8px;
            border: 2px solid;
            text-align: center;
            font-weight: bold;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2;
            box-sizing: border-box;
        }
        .node.root { background-color: var(--root-bg); border-color: var(--root-border); width: 140px; height: 90px; margin-right: 0; }
        .node.blue { background-color: var(--blue-bg); border-color: var(--blue-border); width: 160px; height: 50px; }

        /* æ”¾ç½®å€ (Slot) */
        .slot {
            width: 210px;
            height: 50px;
            border-radius: 8px;
            margin: 5px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: bold;
            text-align: center;
            transition: background-color 0.2s, border-color 0.2s;
            position: relative;
        }
        
        /* ç©ºæ ¼ç‹€æ…‹ */
        .slot.empty { background-color: #fff; border: 2px dashed #aaa; }
        .slot.empty.purple-zone { border-color: var(--purple-border); width: 140px; background-color: #fcfcfc;}
        .slot.empty.yellow-zone { border-color: var(--yellow-border); background-color: #fcfcfc;}
        
        /* æ‹–æ›³ç¶“éæ™‚çš„é«˜äº® */
        .slot.drag-over { background-color: #e0f7fa !important; border-style: solid; transform: scale(1.02); }
        
        /* å·²å¡«æ»¿ç‹€æ…‹ (ç”± JS æ§åˆ¶èƒŒæ™¯è‰²) */
        .slot.filled { border: 2px solid; box-shadow: none; border-style: solid; }
        /* é è¨­çš„é»ƒè‰²å¡«æ»¿ (é·¹æ¶) */
        .slot.filled.static-yellow { background-color: var(--yellow-bg); border-color: var(--yellow-border); }

        /* è®“è¢«æ”¾å…¥çš„ç‰©ä»¶å¡«æ»¿æ ¼å­ */
        .slot .draggable-item {
            width: 100%; height: 100%; margin: 0; box-shadow: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 12px; border: none; background: transparent; cursor: grab;
        }

        .connector { flex-shrink: 0; display: block; }
        .column-group { display: flex; flex-direction: column; gap: 40px; }
        .row-group { display: flex; align-items: center; gap: 0; }
        .sub-options { display: flex; flex-direction: column; justify-content: space-between; height: 180px; }

        #screenshot-btn {
            margin-top: 20px;
            width: 100%;
            padding: 15px;
            background-color: #6aa84f;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        #screenshot-btn:hover { background-color: #588e40; }
    </style>
</head>
<body>

<div id="app-wrapper">
    
    <div class="student-info-row">
        <div class="info-group">
            <span class="info-label">ç·¨è™Ÿï¼š</span>
            <input type="text" class="info-input" placeholder="ä¾‹ï¼šA01">
        </div>
        <div class="info-group">
            <span class="info-label">å§“åï¼š</span>
            <input type="text" class="info-input" placeholder="è«‹è¼¸å…¥å§“å">
        </div>
        <div style="margin-left: auto; color: #666; font-size: 14px;">
            â€» å¯è‡ªç”±æ‹–æ›³èª¿æ•´ï¼Œå®Œæˆå¾Œé»æ“Šå³ä¸‹è§’æŒ‰éˆ•ä¸‹è¼‰
        </div>
    </div>

    <div class="headers-row">
        <div class="header-tag" style="left: 60px;">æ°£å€™è®Šé·å°è¾²æ¥­çš„å½±éŸ¿</div>
        <div class="header-tag" style="left: 420px;">è¾²æ¥­æ°¸çºŒç™¼å±•ç­–ç•¥</div>
        <div class="header-tag" style="left: 640px;">è¾²æ¥­æ‡‰å°æ–¹æ¡ˆ</div>
    </div>

    <div class="content-area">
        <div class="diagram-container">
            
            <div class="node root">æ°£å€™è®Šé·å°<br>è¾²æ¥­çš„å½±éŸ¿</div>

            <svg class="connector" width="50" height="400">
                <path d="M0 200 L25 200" fill="none" stroke="black" stroke-width="2" />
                <path d="M25 50 L25 350" fill="none" stroke="black" stroke-width="2" />
                <path d="M25 50 L50 50" fill="none" stroke="black" stroke-width="2" />
                <path d="M25 200 L50 200" fill="none" stroke="black" stroke-width="2" />
                <path d="M25 350 L50 350" fill="none" stroke="black" stroke-width="2" />
            </svg>

            <div class="column-group">
                
                <div class="row-group">
                    <div class="node blue">æ°´è³‡æºä¾›æ‡‰ä¸ç©©å®š</div>
                    <svg class="connector" width="40" height="20">
                        <line x1="0" y1="10" x2="35" y2="10" stroke="black" stroke-width="2" />
                        <polygon points="35,5 40,10 35,15" fill="black" />
                    </svg>
                    <div class="slot empty purple-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <svg class="connector" width="40" height="180">
                        <path d="M0 90 L10 90" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 25 L10 155" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 25 L40 25" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 90 L40 90" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 155 L40 155" fill="none" stroke="black" stroke-width="2" />
                    </svg>
                    <div class="sub-options">
                        <div class="slot empty yellow-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                        <div class="slot filled static-yellow">é€éæ°´åº«æˆ–é›¨æ°´æ”¶é›†<br>ç¢ºä¿ç©©å®šæ°´æº</div>
                        <div class="slot empty yellow-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    </div>
                </div>

                <div class="row-group">
                    <div class="node blue">æ¥µç«¯æ°£å€™</div>
                    <svg class="connector" width="40" height="20">
                        <line x1="0" y1="10" x2="35" y2="10" stroke="black" stroke-width="2" />
                        <polygon points="35,5 40,10 35,15" fill="black" />
                    </svg>
                    <div class="slot empty purple-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <svg class="connector" width="40" height="180">
                        <path d="M0 90 L10 90" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 25 L10 155" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 25 L40 25" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 90 L40 90" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 155 L40 155" fill="none" stroke="black" stroke-width="2" />
                    </svg>
                    <div class="sub-options">
                        <div class="slot filled static-yellow">é¸æ“‡é©æ‡‰æ°£å€™è®Šé·<br>çš„è€æ—±ä½œç‰©</div>
                        <div class="slot empty yellow-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                        <div class="slot empty yellow-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    </div>
                </div>

                <div class="row-group">
                    <div class="node blue">è¾²ç”°æ°´è³ªæ±¡æŸ“</div>
                    <svg class="connector" width="40" height="20">
                        <line x1="0" y1="10" x2="35" y2="10" stroke="black" stroke-width="2" />
                        <polygon points="35,5 40,10 35,15" fill="black" />
                    </svg>
                    <div class="slot empty purple-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    <svg class="connector" width="40" height="180">
                        <path d="M0 90 L10 90" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 25 L10 155" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 25 L40 25" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 90 L40 90" fill="none" stroke="black" stroke-width="2" />
                        <path d="M10 155 L40 155" fill="none" stroke="black" stroke-width="2" />
                    </svg>
                    <div class="sub-options">
                        <div class="slot filled static-yellow">ç›£æ¸¬è¾²ç”°æ°´è³ªï¼Œ<br>æ¸›å°‘æ±¡æŸ“æº</div>
                        <div class="slot empty yellow-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                        <div class="slot empty yellow-zone" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                    </div>
                </div>

            </div>
        </div>

        <div class="sidebar">
            <div class="sidebar-title">å¾…é¸å€</div>
            <div class="items-container" ondrop="drop(event)" ondragover="allowDrop(event)" id="sidebar-container">
                <div class="draggable-item item-purple" draggable="true" ondragstart="drag(event)" id="p1">ç¶­è­·æ°´è³ª</div>
                <div class="draggable-item item-purple" draggable="true" ondragstart="drag(event)" id="p2">å¼·åŒ–è¾²æ¥­éŸŒæ€§</div>
                <div class="draggable-item item-purple" draggable="true" ondragstart="drag(event)" id="p3">èª¿ç¯€æ°´è³‡æº</div>
                
                <hr style="width: 100%; border: 1px dashed #ccc;">

                <div class="draggable-item item-yellow" draggable="true" ondragstart="drag(event)" id="y1">æ¨å»£æœ‰æ©Ÿè¾²æ¥­ï¼Œæå‡åœŸå£¤å¥åº·èˆ‡ç”Ÿç”¢åŠ›</div>
                <div class="draggable-item item-yellow" draggable="true" ondragstart="drag(event)" id="y2">ä½¿ç”¨æ™ºæ…§çŒæº‰æŠ€è¡“ï¼Œæ¸›å°‘æ°´è³‡æºæµªè²»</div>
                <div class="draggable-item item-yellow" draggable="true" ondragstart="drag(event)" id="y3">æ¸›å°‘è¾²æ¥­åŒ–å­¸æ±¡æŸ“ï¼Œé™ä½æ°´æºæ±¡æŸ“é¢¨éšª</div>
                <div class="draggable-item item-yellow" draggable="true" ondragstart="drag(event)" id="y4">ç™¼å±•æ··åˆç¨®æ¤ï¼Œæ¸›å°‘æ¥µç«¯å¤©æ°£é¢¨éšª</div>
                <div class="draggable-item item-yellow" draggable="true" ondragstart="drag(event)" id="y5">ä½¿ç”¨å¤©ç„¶æ°´ç”Ÿæ¤ç‰©ä¾†å¸æ”¶æ±¡æŸ“</div>
                <div class="draggable-item item-yellow" draggable="true" ondragstart="drag(event)" id="y6">èª¿æ•´çŒæº‰æ–¹å¼ï¼Œæé«˜è¾²æ¥­ç”¨æ°´æ•ˆç‡</div>
            </div>

            <button id="screenshot-btn" onclick="takeScreenshot()">
                ğŸ“· ä¸‹è¼‰å¯¦é©—æˆªåœ–
            </button>
        </div>
    </div>
</div>

<script>
    // è¨˜éŒ„è¢«æ‹–æ›³çš„ç‰©ä»¶åŸæœ¬çš„çˆ¶å±¤ï¼Œç”¨æ–¼ç‹€æ…‹é‚„åŸ
    let draggedItem = null;
    let oldParent = null;

    function allowDrop(ev) {
        ev.preventDefault(); // å…è¨±æ”¾ç½®
        // è¦–è¦ºå›é¥‹ï¼šå¦‚æœæ‹–åˆ°å¯æ”¾ç½®å€åŸŸï¼Œé¡¯ç¤ºå¯ç§»å‹•æ¸¸æ¨™
        ev.dataTransfer.dropEffect = "move";
    }

    function drag(ev) {
        draggedItem = ev.target;
        oldParent = ev.target.parentElement;
        ev.dataTransfer.setData("text", ev.target.id);
        ev.target.style.opacity = "0.5";
    }

    document.addEventListener("dragend", function(event) {
        event.target.style.opacity = "1";
        // æ¸…é™¤æ‰€æœ‰ drag-over æ¨£å¼
        document.querySelectorAll('.drag-over').forEach(el => el.classList.remove('drag-over'));
    });

    // æ‹–æ›³é€²å…¥æ™‚çš„è¦–è¦ºæ•ˆæœ
    document.addEventListener("dragenter", function(event) {
        let target = event.target;
        // å¦‚æœæ˜¯ .slot æˆ–è€…æ˜¯ items-container
        if (target.classList.contains("slot") || target.classList.contains("items-container")) {
            target.classList.add("drag-over");
        }
    });

    document.addEventListener("dragleave", function(event) {
        let target = event.target;
        if (target.classList.contains("slot") || target.classList.contains("items-container")) {
            target.classList.remove("drag-over");
        }
    });

    function drop(ev) {
        ev.preventDefault();
        var data = ev.dataTransfer.getData("text");
        var draggedElement = document.getElementById(data);
        
        // åˆ¤æ–·ç›®æ¨™å®¹å™¨
        var target = ev.target;
        
        // å‘ä¸Šå°‹æ‰¾ï¼Œç›´åˆ°æ‰¾åˆ° slot æˆ– items-container
        while (target && !target.classList.contains('slot') && !target.classList.contains('items-container')) {
            target = target.parentElement;
        }

        if (!target) return; // æ²’æ‰¾åˆ°æœ‰æ•ˆç›®æ¨™

        target.classList.remove('drag-over');

        // æƒ…å¢ƒ A: æ‹–å›å¾…é¸å€ (Sidebar)
        if (target.classList.contains('items-container')) {
            target.appendChild(draggedElement);
            resetSlotStyle(oldParent); // é‡ç½®èˆŠæ ¼å­çš„æ¨£å¼
            resetItemStyle(draggedElement); // é‡ç½®ç‰©ä»¶æ¨£å¼(æ¢å¾©åŸæœ¬çš„å°å¡ç‰‡æ¨£å­)
            return;
        }

        // æƒ…å¢ƒ B: æ‹–å…¥æ ¼å­ (Slot)
        if (target.classList.contains('slot')) {
            // å¦‚æœæ ¼å­å·²ç¶“æœ‰æ±è¥¿ (ä¸”ä¸æ˜¯è‡ªå·±)ï¼Œä¸å…è¨±æ”¾å…¥ (æˆ–è€…ä½ å¯ä»¥é¸æ“‡äº¤æ›ï¼Œé€™è£¡å…ˆç°¡å–®è™•ç†ç‚ºä¸å…è¨±è¦†è“‹)
            if (target.children.length > 0 && target.children[0] !== draggedElement) {
                // è¦–è¦ºä¸Šçµ¦å€‹æç¤ºï¼Œæˆ–è€…å°±ä»€éº¼éƒ½ä¸åš(å½ˆå›åŸè™•)
                return;
            }

            // æ”¾å…¥æ–°æ ¼å­
            target.appendChild(draggedElement);
            
            // è™•ç†èˆŠæ ¼å­ï¼šå¦‚æœå®ƒä¾†è‡ªå¦ä¸€å€‹ Slotï¼ŒèˆŠçš„è¦è®Šå›ç©ºç™½
            resetSlotStyle(oldParent);

            // è™•ç†æ–°æ ¼å­ï¼šè®Šæ›´ç‚º Filled ç‹€æ…‹
            target.classList.remove('empty');
            target.classList.add('filled');
            
            // æ ¹æ“šç‰©ä»¶é¡å‹è¨­å®šèƒŒæ™¯è‰²
            if (draggedElement.classList.contains('item-purple')) {
                target.style.backgroundColor = "var(--purple-bg)";
                target.style.borderColor = "var(--purple-border)";
            } else {
                target.style.backgroundColor = "var(--yellow-bg)";
                target.style.borderColor = "var(--yellow-border)";
            }

            // ä¿®æ”¹ç‰©ä»¶æœ¬èº«çš„æ¨£å¼ï¼Œè®“å®ƒé©æ‡‰æ ¼å­å¤§å°
            draggedElement.style.width = "100%";
            draggedElement.style.height = "100%";
            draggedElement.style.border = "none";
            draggedElement.style.background = "transparent";
            draggedElement.style.boxShadow = "none";
        }
    }

    // è¼”åŠ©å‡½å¼ï¼šé‚„åŸæ ¼å­çš„ç©ºç™½ç‹€æ…‹
    function resetSlotStyle(element) {
        if (element && element.classList.contains('slot')) {
            // æª¢æŸ¥æ˜¯å¦çœŸçš„ç©ºäº† (ä»¥é˜²é‚è¼¯éŒ¯èª¤)
            if (element.children.length === 0) {
                element.classList.add('empty');
                element.classList.remove('filled');
                element.style.backgroundColor = ""; // ç§»é™¤è¡Œå…§æ¨£å¼ï¼Œæ¢å¾© CSS é è¨­
                element.style.borderColor = "";
            }
        }
    }

    // è¼”åŠ©å‡½å¼ï¼šé‚„åŸç‰©ä»¶åœ¨å¾…é¸å€çš„æ¨£å¼
    function resetItemStyle(element) {
        element.style.width = "90%";
        element.style.height = ""; // è‡ªå‹•é«˜åº¦
        element.style.border = "2px solid #000";
        element.style.boxShadow = "2px 2px 5px rgba(0,0,0,0.1)";
        if (element.classList.contains('item-purple')) {
            element.style.backgroundColor = "var(--purple-bg)";
        } else {
            element.style.backgroundColor = "var(--yellow-bg)";
        }
    }

    function takeScreenshot() {
        var btn = document.getElementById('screenshot-btn');
        btn.style.display = 'none'; 

        // ç²å–è¼¸å…¥çš„ç·¨è™Ÿå’Œå§“å
        var inputs = document.querySelectorAll('.info-input');
        var fileName = 'å¯¦é©—çµæœ';
        
        if(inputs[0].value) fileName += '_' + inputs[0].value;
        if(inputs[1].value) fileName += '_' + inputs[1].value;

        html2canvas(document.querySelector("#app-wrapper"), {
            scale: 2 
        }).then(canvas => {
            btn.style.display = 'block'; 
            var link = document.createElement('a');
            link.download = fileName + '.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    }
</script>

</body>
</html>